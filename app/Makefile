#------------------------------------------------------------------------------
# Main Targets
#------------------------------------------------------------------------------
all: sub_app

#------------------------------------------------------------------------------
# Config
#------------------------------------------------------------------------------
OS = $(shell uname)

#------------------------------------------------------------------------------
# Compiler
#------------------------------------------------------------------------------

# C Compiler and Linker Executable
CC      := $(CROSS)gcc


#------------------------------------------------------------------------------
# Inc && Lib 
#------------------------------------------------------------------------------
LDLIB   := 

#------------------------------------------------------------------------------
# Compiler Flags 
#------------------------------------------------------------------------------
CFLAGS  := -O2 -Wall -Werror -g

#------------------------------------------------------------------------------
# Linker Flags 
#------------------------------------------------------------------------------
LDFLAGS := -lsub -L../lib
ifneq (,$(findstring $(OS),Linux Darwin))
	CFLAGS += -I../lib -I../libusb/libusb-win32-src/src
	LDFLAGS += -L/usr/local/lib -lusb-1.0 -lm
else
 ifdef WIN_BLD
	CFLAGS += -I "${PROGRAMFILES}\SUB-20\inc"
    LDFLAGS = -L"${PROGRAMFILES}\SUB-20\lib\msvc\win32" -lsub20
 else
	CFLAGS += -D__SUB_STATIC__ -I../lib -I../libusb/libusb-win32-src/src
	LDFLAGS += -L../libusb/libusb-win32-src -lusb
 endif
endif

#------------------------------------------------------------------------------
# Common rules
#------------------------------------------------------------------------------
%.o:	%.c  
	$(CC) -c $(CFLAGS) -o $@ $<


#------------------------------------------------------------------------------
# Target Builds
# 
#------------------------------------------------------------------------------
sub_app : sub_app.o cmd_pars.o
	$(CC) -o $@ $^ $(LDFLAGS)

clean:
	rm -f *.o *.out *.err *.exe *.a *.so

